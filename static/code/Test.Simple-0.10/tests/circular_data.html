<head>
  <script type="text/javascript" src="../lib/Test/Builder.js"></script>
  <script type="text/javascript" src="../lib/Test/More.js"></script>
</head>
<pre id="test"><script type="text/javascript">
plan({tests: 7});

var a1 = [ 1, 2, 3 ];
a1.push(a1);
var a2 = [ 1, 2, 3 ];
a2.push(a2);

isDeeply(a1, a2, "isDeeply() with circular arrays");
if (/Safari/.test(navigator.userAgent))
    skip("http://bugzilla.opendarwin.org/show_bug.cgi?id=3539", 1);
else isSet(a1, a2, "isSet() with circular arrays");
ok( _eqArray(a1, a2, [], []), "_eqArray() with cirular arrays");

var h1 = { a: 1, b: 2, c: 3 };
h1.d = h1;
var h2 = { a: 1, b: 2, c: 3 };
h2.d = h2;

isDeeply(h1, h2, "isDeeply() with circular objects");
ok( _eqAssoc(h1, h2, [], []), "_eqAssoc() with cirular objects");

{
    // Make sure the circular ref checks don't get confused by a reference 
    // that is simply repeating.
    var a = { foo: 1 };
    var b = { foo: 1 };
    var c = { foo: 1 };

    isDeeply( [a, a], [b, c],
	      "isDeeply() with repeating references in arrays" );
    isDeeply( { foo: a, bar: a }, { foo: b, bar: c },
	      "isDeeply() with repeating references in objects" );
}
</script></pre>
</body>
